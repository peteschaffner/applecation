# Evergig Git workflow

This is a simple git workflow that we want to enforce for the web projects at Evergig. It is based heavily on the conventions mentioned and linked to in [this gist](https://gist.github.com/jbenet/ee6c9ac48068889b0912).

## The philosophy
- The workflow must be simple … quick, iterative development is what we are after.
- We trust you. Everyone has push/pull access to the repo.
- Small, atomic features/commits over large monolithic ones. Always.
- Pull-requests (PR) are sacred. They are our way of reviewing, testing and signing off on code before merging into `master`. They are also a place for general discussion (designers, devs, management … all are welcome).
- All members of the team should be involved in each PR. Even if the code is over your head, test to make sure it doesn't break your work! This encourages collaboration and pulls input from all corners of the office.
- Stick to the conventions outlined here. We are all for improving the way we work, but lets discuss it before forcing it upon all. If you have ideas or improvements, submit a PR!

## The gist
1. `master` must always be deployable.
2. Branch to develop (features/improvements/bugfixes/etc).
3. Rebase against `master` early and often to avoid/resolve conflicts.
4. PR, then when the team has tested and approved, merge into `master`.

## Commit message etiquette
Commit messages should consist of a one line summary (50 characters or less) followed by an optional description (wrapped at 72 characters):

```
Capitalized, short (50 chars or less) summary

More detailed explanatory text, if necessary.  Wrap it to about 72
characters or so.  In some contexts, the first line is treated as the
subject of an email and the rest of the text as the body.  The blank
line separating the summary from the body is critical (unless you omit
the body entirely); tools like rebase can get confused if you run the
two together.

Write your commit message in the present tense: "Fix bug" and not "Fixed
bug."  This convention matches up with commit messages generated by
commands like git merge and git revert.

Further paragraphs come after blank lines.

- Bullet points are okay, too

- Typically a hyphen or asterisk is used for the bullet, preceded by a
  single space, with blank lines in between, but conventions vary here

- Use a hanging indent
```

This style makes it easier to divine meaning whilst skimming through `git log`, not to mention it helps you reflect on the true purpose of your commit ;) Check out [Tim Pope’s blog](http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html) for more info.

## Demo
```bash
# Make sure master is up-to-date.
git checkout master
git pull origin master

# Some work needs done ... get to it!
git checkout -b my-new-feature

# Make some changes.
$EDITOR file

# Commit your incremental, atomic changes.
git add -p
git commit -m "Add my changes"

# Push your branch early for discussion and/or a PR.
# (you might do this many times as you develop)
git push origin my-new-feature

# Keep abreast of other changes to your feature branch and to master.
# Rebasing keeps our code working, merging easy, and history clean.
git fetch origin
git rebase origin/my-new-feature
git rebase origin/master

# Merge when done developing.
# Rebasing in branches reconciles issues, so there should be no conflicts.
# --no-ff preserves feature history and makes for easy full-feature reverts.
# (GitHub does this by default in a pull-request merge)
git checkout master
git pull origin master
git merge --no-ff my-new-feature

# Prep and commit a release
$EDITOR History.md
git commit -m "Release 1.0.0-RC1"
git tag 1.0.0-RC1
git push
git push --tags
```

## Gotchas and helpful commands
- `git add -p` — incrementally add changed hunks to the index
- If you mistakenly branch off of an existing branch (rather than off `master`), the easiest way to get things straight is to run `git rebase --onto master <branch-or-hash-you-branched-from>`. This should go smoothly unless you have edited the same files in both branches.
- Use `rebase` with caution! Say you are working on a feature-branch and push to `origin` so as to collaborate with the team, it is important to remember that rebasing with `origin/master` requires slightly more attention than while working alone. In this scenario, if you `git rebase origin/master` and rewrite history on your feature branch, you will need to [force] push those change to the remote with `git push -f origin <feature-branch>` and this means your teammate(s) **must** `git rebase origin/<feature-branch>` before they push (though it is good practice to do this regardless). One way to circumvent such issues is to try and wait to rebase against `origin/master` only right before you are ready to merge the feature branch. This way, your teammate(s) should not be affected. Now this might seem a little precarious, and that is because it is … but it is the price we must pay for adhering to such a simple branching/merging model.
- When reviewing a PR it is common and good practice to comment directly on a line of code in the diffs. This should be done, however, in the “Files Changed” tab of the PR, because doing so directly on a commit hash view (i.e. the URL in your address bar looks something like …evergig.com/commit/fb6e295ffa6295b283f4175426f25c6f56d966dc) means that this discussion could easily become lost if the feature-branch is rebased.

![Files Changed tab](https://f.cloud.github.com/assets/411395/1382801/159e25e2-3b33-11e3-95ef-deb56e540357.png)
